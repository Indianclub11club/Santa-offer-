<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ego Quiz - Ultimate Edition</title>
    
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            --neon-red: #ff0055;
            --neon-green: #00ff99;
            --neon-orange: #ff4500;
            --bg-dark: #050505;
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            --font-main: 'Segoe UI', sans-serif;
        }

        * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; font-family: var(--font-main); }
        body { margin: 0; padding: 0; background-color: var(--bg-dark); background-image: radial-gradient(circle at 50% 30%, #111 0%, #000 85%); color: white; height: 100vh; overflow: hidden; display: flex; flex-direction: column; align-items: center; }

        /* --- ADSTERRA WRAPPER --- */
        #adsterra-native-wrapper {
            width: 100%; max-width: 350px; min-height: 100px; margin: 10px auto;
            text-align: center; z-index: 50; display: none; /* Hidden initially */
            justify-content: center; align-items: center;
            background: rgba(255, 255, 255, 0.02); border-radius: 8px; padding: 5px;
            position: relative; /* Ensure it respects flow */
        }
        #adsterra-native-wrapper iframe { pointer-events: auto; }

        /* --- SCREENS --- */
        .screen { display: none; flex-direction: column; align-items: center; justify-content: center; width: 100%; height: 100%; padding: 20px; text-align: center; position: relative; overflow-y: auto; }
        .screen.active { display: flex; }

        /* --- STYLES --- */
        .hero-title { font-size: 2.8rem; font-weight: 900; text-transform: uppercase; position: relative; color: white; letter-spacing: -2px; margin-bottom: 5px; animation: glitch 1s linear infinite; }
        .ego-sub { color: #bbb; font-size: 0.95rem; letter-spacing: 2px; text-transform: uppercase; margin-bottom: 20px; font-weight: 600; opacity: 0.8; }
        .live-stats { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; width: 100%; max-width: 350px; }
        .stat-card { background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(0,0,0,0.5)); border: 1px solid rgba(255,255,255,0.1); padding: 15px; border-radius: 12px; flex: 1; }
        .stat-val { display: block; font-size: 1.4rem; font-weight: bold; }
        .stat-label { font-size: 0.7rem; color: #888; }
        
        /* FIX: High Z-Index for Input & Button */
        .input-group { margin-bottom: 20px; width: 100%; max-width: 300px; position: relative; z-index: 1000; }
        input[type="text"] { background: transparent; border: none; border-bottom: 2px solid #333; padding: 15px; width: 100%; color: white; text-align: center; font-size: 1.2rem; outline: none; transition: 0.4s; font-weight: bold; pointer-events: auto; }
        input[type="text"]:focus { border-bottom: 2px solid var(--neon-blue); text-shadow: 0 0 10px var(--neon-blue); }
        
        .btn-start { 
            background: white; color: black; border: none; padding: 18px 50px; 
            font-size: 1.1rem; font-weight: 900; text-transform: uppercase; 
            cursor: pointer; clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%); 
            transition: 0.3s; position: relative; z-index: 1000; /* FIX: High Priority */
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2); 
            pointer-events: auto;
        }
        .btn-start:hover { background: var(--neon-blue); box-shadow: 0 0 30px var(--neon-blue); transform: translateY(-2px); }

        /* Level Indicator */
        .level-badge { font-size: 0.8rem; color: var(--neon-blue); text-transform: uppercase; letter-spacing: 3px; margin-bottom: 10px; padding: 5px 15px; border: 1px solid rgba(0, 243, 255, 0.3); border-radius: 20px; background: rgba(0, 243, 255, 0.05); box-shadow: 0 0 10px rgba(0, 243, 255, 0.1); animation: pulse-glow 2s infinite; }
        .ego-hint { font-size: 0.85rem; color: #aaa; font-style: italic; margin-bottom: 15px; min-height: 20px; transition: opacity 0.5s; text-shadow: 0 0 5px rgba(255,255,255,0.1); }
        .question-box { background: rgba(20, 20, 20, 0.6); backdrop-filter: blur(10px); border: 1px solid var(--glass-border); padding: 25px; border-radius: 16px; width: 100%; max-width: 400px; min-height: 120px; display: flex; align-items: center; justify-content: center; margin-bottom: 30px; font-size: 1.3rem; font-weight: 600; line-height: 1.5; box-shadow: 0 10px 40px rgba(0,0,0,0.5); position: relative; overflow: hidden; opacity: 0; }
        .question-box::after { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, var(--neon-purple), transparent); animation: scanline 3s infinite; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 400px; }
        .opt-btn { background: linear-gradient(145deg, rgba(255,255,255,0.03), rgba(0,0,0,0.8)); border: 1px solid var(--glass-border); color: #e0e0e0; padding: 20px 10px; font-size: 1rem; font-weight: 500; cursor: pointer; border-radius: 12px; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; opacity: 0; text-align: center; z-index: 10; }
        .opt-btn:hover { border-color: var(--neon-blue); box-shadow: 0 0 15px rgba(0, 243, 255, 0.2); color: white; transform: translateY(-2px); }
        .opt-btn:active { transform: scale(0.95); background: rgba(0, 243, 255, 0.1); }
        .opt-btn.correct { border-color: var(--neon-green) !important; box-shadow: 0 0 20px var(--neon-green) !important; background: rgba(0, 255, 153, 0.1) !important; }
        .opt-btn.wrong { border-color: var(--neon-red) !important; animation: shake 0.4s !important; background: rgba(255, 0, 85, 0.1) !important; }

        /* Animations */
        .slide-up { animation: slideUpFade 0.5s ease forwards; }
        @keyframes slideUpFade { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse-glow { 0% { box-shadow: 0 0 5px rgba(0, 243, 255, 0.1); } 50% { box-shadow: 0 0 15px rgba(0, 243, 255, 0.4); } 100% { box-shadow: 0 0 5px rgba(0, 243, 255, 0.1); } }
        @keyframes scanline { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        @keyframes glitch { 0% { clip: rect(30px, 9999px, 10px, 0); } 100% { clip: rect(80px, 9999px, 90px, 0); } }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } 100% { transform: translateX(0); } }
        @keyframes pulse-btn { 0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(255, 255, 255, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); } }
        .pulse { animation: pulse-btn 2s infinite; }

        /* Modals */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(8px); }
        .modal-content { text-align: center; padding: 30px; border: 2px solid #333; background: #0a0a0a; width: 350px; border-radius: 15px; }
        .title-success { color: var(--neon-green); text-shadow: 0 0 10px var(--neon-green); }
        .title-fail { color: var(--neon-red); }
        .title-revenge { color: var(--neon-orange); text-transform: uppercase; font-size: 1.8rem; margin-bottom: 10px; text-shadow: 0 0 15px var(--neon-orange); }
        .btn-main { background: white; color: black; border: none; padding: 15px 40px; font-weight: 900; text-transform: uppercase; cursor: pointer; clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%); transition: 0.2s; position: relative; z-index: 100; }
        .btn-main:hover { background: var(--neon-blue); box-shadow: 0 0 15px var(--neon-blue); }
        .btn-revenge { background: var(--neon-orange); color: white; box-shadow: 0 0 20px var(--neon-orange); animation: shake 0.5s infinite; }
        .progress-bar { position: absolute; top: 0; left: 0; width: 0%; height: 3px; background: var(--neon-purple); transition: 0.3s; box-shadow: 0 0 10px var(--neon-purple); }

    </style>
</head>
<body>

    <div id="adsterra-native-wrapper"></div>

    <div class="progress-bar" id="progressBar"></div>
    <div class="streak-container" id="streakBadge" style="display:none; position:absolute; top:15px; right:15px; background:rgba(255,69,0,0.2); border:1px solid orangered; padding:5px 10px; border-radius:15px; font-size:0.9rem; color:orangered;">üî• Streak: <span id="streakCount">0</span></div>
    <div class="ghost-notify" id="ghostNotify" style="position:fixed; top:60px; background:rgba(0,243,255,0.1); border-left:3px solid var(--neon-blue); color:var(--neon-blue); padding:10px 20px; font-size:0.8rem; transform:translateX(120%); transition:0.5s; border-radius: 4px; z-index:1500;">Rohit just passed Level 5 üöÄ</div>

    <div id="entryScreen" class="screen active">
        <h1 class="hero-title" data-text="DARE TO PLAY?">DARE TO PLAY?</h1>
        <p class="ego-sub">Only 0.1% reach the end</p>
        <div class="live-stats">
            <div class="stat-card stat-fail"><span class="stat-val">1,248</span><span class="stat-label">FAILED TODAY</span></div>
            <div class="stat-card stat-level"><span class="stat-val">Lvl 12</span><span class="stat-label">HIGHEST RECORD</span></div>
        </div>
        
        <div class="input-group">
            <input type="text" id="username" placeholder="ENTER CODENAME" autocomplete="off">
        </div>
        
        <button id="startBtn" class="btn-start pulse" onclick="enterGame()">ENTER ARENA</button>
    </div>

    <div id="gameScreen" class="screen">
        <div class="level-badge">LEVEL <span id="levelNum">1</span></div>
        <div id="egoHint" class="ego-hint">Focus... This one is tricky.</div>
        <div class="question-box" id="qText">Loading...</div>
        <div class="options-grid" id="optContainer"></div>
        <div class="ad-slot-game" style="margin-top:30px;"></div>
    </div>

    <div id="successModal" class="modal">
        <div class="modal-content" style="border-color: var(--neon-green);">
            <h2 class="title-success">CORRECT! ‚úÖ</h2>
            <p id="successMsg" style="color:#ddd; margin-bottom: 20px;">Logic sahi tha! üòé</p>
            <div id="modal-ad-slot" style="margin: 15px auto;"></div>
            <button class="btn-main" onclick="nextLevel()">Next Level üöÄ</button>
        </div>
    </div>

    <div id="failModal" class="modal">
        <div class="modal-content" style="border-color: var(--neon-red);">
            <h2 class="title-fail">FAILED ‚ùå</h2>
            <p id="failMsg" style="color:#ddd; margin-bottom: 20px;">Overconfidence le dooba? üòè</p>
            <div class="ad-slot-modal" style="margin: 15px auto;"></div>
            <button class="btn-main" onclick="retryLevel()">Retry Level</button>
        </div>
    </div>

    <div id="revengeModal" class="modal">
        <div class="modal-content" style="border-color: var(--neon-orange); box-shadow: 0 0 30px rgba(255, 69, 0, 0.3);">
            <h2 class="title-revenge">üî• REVENGE MODE</h2>
            <p style="color:white; font-size:1.1rem; margin-bottom: 10px;">Kismat kharab thi ya sawal hard? ü§î</p>
            <p style="color:#aaa; font-size: 0.95rem; margin-bottom: 25px;">Ek galti maaf... <br><span style="color: var(--neon-orange); font-weight:bold;">New Question Loading...</span></p>
            <button class="btn-main btn-revenge" onclick="activateRevenge()">BRING IT ON! ‚öîÔ∏è</button>
        </div>
    </div>

    <script>
        /* --- 1. ADSTERRA SMART MANAGEMENT --- */
        let adsAllowed = false; 

        function initAdNetwork() {
            if (adsAllowed) return; 
            adsAllowed = true;
            console.log("Ads Initialized");

            let popScript = document.createElement('script');
            popScript.src = "https://pl28323070.effectivegatecpm.com/33/31/f0/3331f0bf593df358f60b72a1918fb61c.js";
            document.head.appendChild(popScript);

            let bannerScript = document.createElement('script');
            bannerScript.src = "https://pl28323063.effectivegatecpm.com/ed0499a255f96083e92a9524840692b6/invoke.js";
            bannerScript.setAttribute('async', 'async');
            bannerScript.setAttribute('data-cfasync', 'false');
            
            let bannerDiv = document.createElement('div');
            bannerDiv.id = "container-ed0499a255f96083e92a9524840692b6";

            let wrapper = document.getElementById('adsterra-native-wrapper');
            wrapper.style.display = "flex"; 
            wrapper.appendChild(bannerScript);
            wrapper.appendChild(bannerDiv);
        }

        const adWrapper = document.getElementById('adsterra-native-wrapper');
        
        function moveAdTo(targetSelector) {
            if (!adsAllowed) return; 
            const target = document.querySelector(targetSelector);
            if(target && adWrapper) target.appendChild(adWrapper);
        }

        /* --- 2. GAME LOGIC --- */
        const messages = {
            success: ["Lagta hai dimaag sahi direction mein hai üòé", "Ab samajh aaya kyu aaye ho yahan üß†", "Tukka tha ya talent? Jo bhi ho, sahi hai üî•"],
            fail: ["Bas? Itni jaldi hawa nikal gayi? üéà", "Retry karo... izzat abhi bachi hai üíØ", "Google karne ka time nahi mila? üòÇ"],
            ghost: ["Rohit just cleared this level üöÄ", "Amit is now on Level 10 üòà", "Priya is catching up fast üî•"],
            hints: ["Focus... This one is not easy.", "Confidence ya guess? Soch lo.", "Legends think before tapping.", "Galti ki gunjaish nahi hai.", "Are you sure about this?", "Don't let your ego decide.", "Easy lag raha hai? Wahi trap hai."]
        };

        let activeQuestions = [
            { q: "Bharat ki Rajdhani?", a: ["Mumbai", "Delhi", "Kolkata", "Pune"], c: 1 },
            { q: "Samosa shape?", a: ["Circle", "Square", "Triangle", "Line"], c: 2 },
            { q: "Heavier: 1kg Iron vs 1kg Cotton?", a: ["Iron", "Cotton", "Equal", "Brain"], c: 2 },
            { q: "Sun rises from?", a: ["West", "North", "East", "South"], c: 2 },
            { q: "Water peete hi jo mar jaye?", a: ["Fish", "Thirst", "Cat", "Human"], c: 1 },
            { q: "Binary for 5?", a: ["101", "110", "111", "100"], c: 0 },
            { q: "2nd ko cross kiya to tum kya ho?", a: ["1st", "2nd", "3rd", "Last"], c: 1 },
            { q: "Month with 28 days?", a: ["Feb", "Dec", "Jan", "All"], c: 3 },
            { q: "After E in English?", a: ["F", "D", "N", "G"], c: 2 },
            { q: "Kal se pehle aaj tha?", a: ["No", "Yes", "Maybe", "Logic"], c: 0 }
        ];

        while(activeQuestions.length < 30) {
            activeQuestions.push({ q: "Hidden Logic Level #" + (activeQuestions.length + 1), a: ["A", "B", "C", "D"], c: 0 });
        }

        let reserveQuestions = [
            { q: "Revenge: 2 + 2 x 2?", a: ["6", "8", "4", "10"], c: 0 },
            { q: "Revenge: Capital of Japan?", a: ["Beijing", "Seoul", "Tokyo", "Bangkok"], c: 2 },
            { q: "Revenge: King of Jungle?", a: ["Tiger", "Lion", "Elephant", "Human"], c: 1 },
            { q: "Revenge: H2O is?", a: ["Gold", "Silver", "Water", "Air"], c: 2 },
            { q: "Revenge: Colors in Rainbow?", a: ["5", "7", "9", "10"], c: 1 },
            { q: "Revenge: Fastest land animal?", a: ["Cheetah", "Horse", "Lion", "Rabbit"], c: 0 },
            { q: "Revenge: 5 x 5 + 5?", a: ["30", "55", "25", "50"], c: 0 },
            { q: "Revenge: Opposite of Cold?", a: ["Ice", "Hot", "Water", "Wind"], c: 1 }
        ];

        let state = { level: 0, streak: 0, failsInLevel: 0, name: "" };

        /* --- 3. START GAME FIX (GLOBAL SCOPE) --- */
        // Explicitly attach to window for GitHub Pages safety
        window.enterGame = function() {
            console.log("Start Button Clicked");
            let n = document.getElementById('username').value;
            if(!n) { 
                document.getElementById('username').style.borderBottom = "2px solid red"; 
                return; 
            }
            state.name = n;
            document.getElementById('entryScreen').classList.remove('active');
            document.getElementById('gameScreen').classList.add('active');
            
            startGhostCompetitor();
            loadLevel(true);
        };

        function loadLevel(first = false) {
            if(state.level >= activeQuestions.length) return alert("YOU WON! GOD LEVEL UNLOCKED üèÜ");

            // CHECK: Enable Ads if Level 3 (Index 2) reached
            if (state.level >= 2 && !adsAllowed) {
                initAdNetwork();
            }

            let q = activeQuestions[state.level];
            document.getElementById('levelNum').innerText = state.level + 1;
            document.getElementById('progressBar').style.width = ((state.level / activeQuestions.length) * 100) + "%";
            
            let qBox = document.getElementById('qText');
            let oBox = document.getElementById('optContainer');
            let hintEl = document.getElementById('egoHint');

            qBox.classList.remove('slide-up');
            void qBox.offsetWidth;
            qBox.classList.add('slide-up');
            qBox.innerText = q.q;

            let randomHint = messages.hints[Math.floor(Math.random() * messages.hints.length)];
            hintEl.style.opacity = 0;
            setTimeout(() => { hintEl.innerText = randomHint; hintEl.style.opacity = 1; }, 200);

            oBox.innerHTML = "";
            q.a.forEach((opt, i) => {
                let btn = document.createElement('div');
                btn.className = 'opt-btn slide-up';
                btn.style.animationDelay = (i * 0.1) + 's';
                btn.innerText = opt;
                btn.onclick = (e) => checkAnswer(i, e.target);
                oBox.appendChild(btn);
            });
            
            if (adsAllowed) moveAdTo('#gameScreen .ad-slot-game');
        }

        function checkAnswer(idx, btnElement) {
            let q = activeQuestions[state.level];
            
            if(idx === q.c) {
                if(btnElement) btnElement.classList.add('correct');
                state.streak++;
                state.failsInLevel = 0;
                updateStreakUI();
                setTimeout(() => showSuccess(), 300);
            } else {
                if(btnElement) btnElement.classList.add('wrong');
                state.streak = 0;
                state.failsInLevel++;
                updateStreakUI();
                setTimeout(() => {
                    if(state.failsInLevel >= 3) showRevengeModal();
                    else showFail();
                }, 400);
            }
        }

        function showRevengeModal() {
            document.getElementById('failModal').style.display = 'none';
            document.getElementById('revengeModal').style.display = 'flex';
        }

        function activateRevenge() {
            document.getElementById('revengeModal').style.display = 'none';
            if(reserveQuestions.length > 0) {
                let randomIndex = Math.floor(Math.random() * reserveQuestions.length);
                let newQ = reserveQuestions[randomIndex];
                reserveQuestions.splice(randomIndex, 1);
                activeQuestions[state.level] = newQ;
                state.failsInLevel = 0; 
                setTimeout(() => { loadLevel(); showGhostNotify("‚ö†Ô∏è New Question Loaded! Good Luck."); }, 200);
            } else {
                alert("No more revenge questions!
